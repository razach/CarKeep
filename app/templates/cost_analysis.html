{% extends "base.html" %}

{% block title %}CarKeep - Cost Analysis{% endblock %}

{% block content %}
<div class="cost-analysis fade-in">
    <div class="analysis-header">
        <h1>üí∞ Cost Analysis</h1>
        <p>Simple breakdown of vehicle costs and potential savings</p>
        <div class="header-actions">
            <a href="{{ url_for('main.index') }}" class="btn btn-secondary">‚Üê Back to Scenarios</a>
        </div>
    </div>
    
    {% if analysis %}
    <div class="analysis-content">
        <!-- Cost Summary Cards -->
        <div class="cost-summary">
            <h3>üìä Cost Overview</h3>
            <div class="summary-cards">
                <div class="summary-card">
                    <h4>Current Monthly Cost</h4>
                    <div class="cost-amount">${{ "{:,.0f}".format(analysis.baseline.total_monthly) }}</div>
                    <small>{{ analysis.baseline.vehicle_name }}</small>
                </div>
                <div class="summary-card">
                    <h4>Lowest Alternative</h4>
                    <div class="cost-amount savings">${{ "{:,.0f}".format(analysis.summary.lowest_monthly_cost) }}</div>
                    <small>{{ analysis.summary.lowest_scenario_name }}</small>
                </div>
                <div class="summary-card">
                    <h4>Potential Monthly Savings</h4>
                    <div class="cost-amount highlight">${{ "{:,.0f}".format(analysis.summary.monthly_savings) }}</div>
                    <small>vs. current vehicle</small>
                </div>
            </div>
        </div>
        
        <!-- Simple Cost Comparison -->
        <div class="cost-comparison">
            <h3>üöó Vehicle Cost Comparison</h3>
            <div class="comparison-table">
                <table>
                    <thead>
                        <tr>
                            <th>Vehicle</th>
                            <th>Monthly Payment</th>
                            <th>Other Costs</th>
                            <th>Total Monthly</th>
                            <th>vs. Current</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Current Vehicle Row -->
                        <tr class="current-vehicle">
                            <td>
                                <strong>{{ analysis.baseline.vehicle_name }}</strong>
                                <small>Current Vehicle</small>
                            </td>
                            <td>${{ "{:,.0f}".format(analysis.baseline.monthly_payment) }}</td>
                            <td>${{ "{:,.0f}".format(analysis.baseline.insurance_monthly + analysis.baseline.maintenance_monthly + analysis.baseline.fuel_monthly) }}</td>
                            <td><strong>${{ "{:,.0f}".format(analysis.baseline.total_monthly) }}</strong></td>
                            <td><span class="baseline-marker">‚Äî</span></td>
                        </tr>
                        
                        <!-- Alternative Vehicles -->
                        {% for scenario in analysis.scenarios %}
                        <tr class="{% if scenario.vs_baseline < 0 %}savings{% else %}cost-increase{% endif %}">
                            <td>
                                <strong>{{ scenario.vehicle_name }}</strong>
                                <small>{{ scenario.description }}</small>
                            </td>
                            <td>${{ "{:,.0f}".format(scenario.monthly_payment) }}</td>
                            <td>${{ "{:,.0f}".format(scenario.insurance_monthly + scenario.maintenance_monthly + scenario.fuel_monthly) }}</td>
                            <td><strong>${{ "{:,.0f}".format(scenario.total_monthly) }}</strong></td>
                            <td>
                                {% if scenario.vs_baseline < 0 %}
                                <span class="savings">-${{ "{:,.0f}".format(scenario.vs_baseline * -1) }}</span>
                                {% else %}
                                <span class="cost-increase">+${{ "{:,.0f}".format(scenario.vs_baseline) }}</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div class="quick-actions">
            <h3>‚ö° Next Steps</h3>
            <div class="action-buttons">
                <a href="{{ url_for('main.create_scenario') }}" class="btn btn-success">‚ûï Add More Scenarios</a>
                <a href="{{ url_for('main.edit_baseline') }}" class="btn btn-warning">‚úèÔ∏è Update Baseline</a>
                <a href="{{ url_for('main.comparison') }}" class="btn btn-outline">üìä View Comparison</a>
            </div>
        </div>
    </div>
    
    {% else %}
    <div class="no-scenarios">
        <div class="empty-state">
            <h3>üìù No Scenarios Yet</h3>
            <p>Create scenarios to see cost analysis and potential savings.</p>
            <a href="{{ url_for('main.create_scenario') }}" class="btn btn-success">Create First Scenario</a>
        </div>
    </div>
    {% endif %}
</div>

<style>
.cost-analysis {
    max-width: 1200px;
    margin: 0 auto;
    padding: 2rem;
}

.analysis-header {
    text-align: center;
    margin-bottom: 3rem;
    padding: 2rem;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.analysis-header h1 {
    margin-bottom: 1rem;
    font-size: 2.5rem;
    color: #2c3e50;
}

.analysis-header p {
    font-size: 1.1rem;
    color: #7f8c8d;
    margin-bottom: 1.5rem;
}

.header-actions {
    margin-top: 1.5rem;
}

/* Cost Summary Cards */
.cost-summary {
    margin-bottom: 3rem;
}

.cost-summary h3 {
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.5rem;
    color: #2c3e50;
}

.summary-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.summary-card {
    background: white;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    text-align: center;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.summary-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.summary-card h4 {
    margin-bottom: 1rem;
    color: #7f8c8d;
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.cost-amount {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.cost-amount.savings {
    color: #27ae60;
}

.cost-amount.highlight {
    color: #e74c3c;
}

.summary-card small {
    color: #95a5a6;
    font-size: 0.9rem;
}

/* Cost Comparison Table */
.cost-comparison {
    margin-bottom: 3rem;
}

.cost-comparison h3 {
    text-align: center;
    margin-bottom: 2rem;
    font-size: 1.5rem;
    color: #2c3e50;
}

.comparison-table {
    background: white;
    border-radius: 16px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    overflow: hidden;
}

.comparison-table table {
    width: 100%;
    border-collapse: collapse;
}

.comparison-table th {
    background: #f8f9fa;
    padding: 1rem;
    text-align: left;
    font-weight: 600;
    color: #2c3e50;
    border-bottom: 1px solid #e9ecef;
}

.comparison-table td {
    padding: 1rem;
    border-bottom: 1px solid #e9ecef;
    vertical-align: top;
}

.comparison-table tr:last-child td {
    border-bottom: none;
}

.comparison-table tr.current-vehicle {
    background: #f8f9fa;
    font-weight: 600;
}

.comparison-table tr.savings {
    background: #f0fff4;
}

.comparison-table tr.cost-increase {
    background: #fff5f5;
}

.comparison-table strong {
    color: #2c3e50;
    display: block;
    margin-bottom: 0.25rem;
}

.comparison-table small {
    color: #7f8c8d;
    font-size: 0.85rem;
}

.baseline-marker {
    color: #95a5a6;
    font-style: italic;
}

.savings {
    color: #27ae60;
    font-weight: 600;
}

.cost-increase {
    color: #e74c3c;
    font-weight: 600;
}

/* Quick Actions */
.quick-actions {
    text-align: center;
    margin-top: 3rem;
}

.quick-actions h3 {
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
    color: #2c3e50;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}

/* Empty State */
.no-scenarios {
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state h3 {
    margin-bottom: 1rem;
    color: #2c3e50;
}

.empty-state p {
    color: #7f8c8d;
    margin-bottom: 2rem;
}

/* Responsive Design */
@media (max-width: 768px) {
    .cost-analysis {
        padding: 1rem;
    }
    
    .summary-cards {
        grid-template-columns: 1fr;
    }
    
    .comparison-table {
        overflow-x: auto;
    }
    
    .action-buttons {
        flex-direction: column;
        align-items: center;
    }
    
    .action-buttons .btn {
        width: 100%;
        max-width: 300px;
    }
}
</style>
{% endblock %}
