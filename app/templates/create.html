{% extends "base.html" %}

{% block title %}CarKeep - Create New Scenario{% endblock %}

{% block content %}
<div class="create-scenario fade-in">
    <div class="create-header">
        <h1>‚ûï Create New Scenario</h1>
        <p>Add a new vehicle cost comparison scenario to your analysis</p>
        <a href="{{ url_for('main.index') }}" class="btn btn-secondary">‚Üê Back to Scenarios</a>
    </div>
    
    <div class="create-form">
        <form method="POST" action="{{ url_for('main.create_scenario') }}" id="scenarioForm">
            <div class="form-section">
                <h3>üìù Basic Information</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="scenario_name">Scenario Name *</label>
                        <input type="text" id="scenario_name" name="scenario_name" required 
                               placeholder="e.g., new_tesla_model_3" pattern="[a-z0-9_]+"
                               data-tooltip="Use lowercase letters, numbers, and underscores only">
                        <small class="form-help">Use lowercase letters, numbers, and underscores only</small>
                    </div>
                    <div class="form-group">
                        <label for="description">Description *</label>
                        <textarea id="description" name="description" required 
                                  placeholder="Brief description of the scenario" rows="3"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>üöó Vehicle Details</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicle_name">Vehicle Name *</label>
                        <input type="text" id="vehicle_name" name="vehicle_name" required 
                               placeholder="e.g., Tesla Model 3">
                    </div>
                    <div class="form-group">
                        <label for="msrp">MSRP *</label>
                        <div class="input-with-icon">
                            <span class="currency-icon">$</span>
                            <input type="number" id="msrp" name="msrp" required 
                                   placeholder="45000" min="0" step="100">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="current_value">Current Value</label>
                        <div class="input-with-icon">
                            <span class="currency-icon">$</span>
                            <input type="number" id="current_value" name="current_value" 
                                   placeholder="0" min="0" step="100">
                        </div>
                        <small class="form-help">Leave as 0 for new vehicles</small>
                    </div>
                    <div class="form-group">
                        <label for="state">State</label>
                        <select id="state" name="state">
                            <option value="">Use baseline state</option>
                            <option value="VA">Virginia (VA)</option>
                            <option value="TX">Texas (TX)</option>
                            <option value="CA">California (CA)</option>
                            <option value="NY">New York (NY)</option>
                            <option value="FL">Florida (FL)</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>üí∞ Financing</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="financing_type">Financing Type *</label>
                        <select id="financing_type" name="financing_type" required>
                            <option value="">Select financing type</option>
                            <option value="lease">Lease</option>
                            <option value="loan">Loan</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="monthly_payment">Monthly Payment *</label>
                        <div class="input-with-icon">
                            <span class="currency-icon">$</span>
                            <input type="number" id="monthly_payment" name="monthly_payment" required 
                                   placeholder="500" min="0" step="0.01">
                        </div>
                    </div>
                </div>
                
                <!-- Lease-specific fields -->
                <div id="lease-fields" class="conditional-fields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lease_terms">Lease Terms (months)</label>
                            <select id="lease_terms" name="lease_terms">
                                <option value="24">24 months</option>
                                <option value="36" selected>36 months</option>
                                <option value="48">48 months</option>
                                <option value="60">60 months</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="down_payment">Down Payment</label>
                            <div class="input-with-icon">
                                <span class="currency-icon">$</span>
                                <input type="number" id="down_payment" name="down_payment" 
                                       placeholder="0" min="0" step="100">
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Loan-specific fields -->
                <div id="loan-fields" class="conditional-fields" style="display: none;">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="loan_term">Loan Term (months)</label>
                            <select id="loan_term" name="loan_term">
                                <option value="36">36 months</option>
                                <option value="48">48 months</option>
                                <option value="60" selected>60 months</option>
                                <option value="72">72 months</option>
                                <option value="84">84 months</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="interest_rate">Interest Rate (%)</label>
                            <input type="number" id="interest_rate" name="interest_rate" 
                                   placeholder="5.5" min="0" max="25" step="0.1">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h3>üîÑ Trade-in & Incentives</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="trade_in_value">Trade-in Value</label>
                        <div class="input-with-icon">
                            <span class="currency-icon">$</span>
                            <input type="number" id="trade_in_value" name="trade_in_value" 
                                   placeholder="0" min="0" step="100">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="incentives">Incentives/Rebates</label>
                        <div class="input-with-icon">
                            <span class="currency-icon">$</span>
                            <input type="number" id="incentives" name="incentives" 
                                   placeholder="0" min="0" step="100">
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="form-actions">
                <button type="submit" class="btn btn-success">
                    <span class="btn-text">Create Scenario</span>
                    <span class="btn-loading" style="display: none;">Creating...</span>
                </button>
                <button type="reset" class="btn btn-secondary">Reset Form</button>
                <a href="{{ url_for('main.index') }}" class="btn btn-outline">Cancel</a>
            </div>
        </form>
    </div>
</div>

<script>
// Show/hide conditional fields based on financing type
document.getElementById('financing_type').addEventListener('change', function() {
    const leaseFields = document.getElementById('lease-fields');
    const loanFields = document.getElementById('loan-fields');
    
    if (this.value === 'lease') {
        leaseFields.style.display = 'block';
        loanFields.style.display = 'none';
    } else if (this.value === 'loan') {
        leaseFields.style.display = 'none';
        loanFields.style.display = 'block';
    } else {
        leaseFields.style.display = 'none';
        loanFields.style.display = 'none';
    }
});

// Form validation
document.getElementById('scenarioForm').addEventListener('submit', function(e) {
    const scenarioName = document.getElementById('scenario_name').value;
    const pattern = /^[a-z0-9_]+$/;
    
    if (!pattern.test(scenarioName)) {
        e.preventDefault();
        alert('Scenario name must contain only lowercase letters, numbers, and underscores.');
        return false;
    }
    
    // Show loading state
    const submitBtn = document.querySelector('button[type="submit"]');
    const btnText = submitBtn.querySelector('.btn-text');
    const btnLoading = submitBtn.querySelector('.btn-loading');
    
    btnText.style.display = 'none';
    btnLoading.style.display = 'inline';
    submitBtn.disabled = true;
});
</script>
{% endblock %}
