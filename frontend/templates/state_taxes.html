{% extends "base.html" %}

{% block title %}CarKeep - State Tax Configuration{% endblock %}

{% block content %}
<div class="state-taxes fade-in">
    <div class="tax-header">
        <h1>üèõÔ∏è State Tax Configuration</h1>
        <p>Manage property tax rates and relief programs for different states</p>
        <div class="header-actions">
            <a href="{{ url_for('frontend.index') }}" class="btn btn-secondary">‚Üê Back to Scenarios</a>
        </div>
    </div>
    
    <div class="tax-content">
        <div class="current-states">
            <h3>üìä Current State Configurations</h3>
            <div class="states-grid" id="states-grid">
                {% for state_code, config in states.items() %}
                {% include 'components/state_tax_row.html' %}
                {% endfor %}
            </div>
        </div>
        
        <div class="add-state-section">
            <h3 id="section-title">‚ûï Add New State</h3>
            
            <div class="tax-explanation" style="background: #f8f9fa; padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; border-left: 4px solid #007bff;">
                <h4>üí° How Fairfax County Personal Property Tax Works:</h4>
                <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                    <li><strong>Base Rate:</strong> 4.57% of vehicle value</li>
                    <li><strong>PPTRA Relief:</strong> 51% relief on the first $20,000 of value</li>
                    <li><strong>Example:</strong> A $30,000 vehicle pays tax on $30,000 at 4.57%, but gets 51% relief on the first $20,000</li>
                    <li><strong>Calculation:</strong> ($30,000 √ó 0.0457) - ($20,000 √ó 0.0457 √ó 0.51) = $1,371 - $466 = $905 total tax</li>
                </ul>
            </div>
            
        <form id="addStateForm" class="add-state-form"
            hx-post="/_state-taxes/create"
            hx-target="#states-grid"
            hx-swap="beforeend">
                <input type="hidden" id="edit_mode" name="edit_mode" value="false">
                <input type="hidden" id="original_state_code" name="original_state_code" value="">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="state_code">State Code *</label>
                        <input type="text" id="state_code" name="state_code" required 
                               placeholder="e.g., NY" maxlength="2" pattern="[A-Za-z]{2}">
                        <small class="form-help">Two-letter state code (e.g., NY, FL, OH)</small>
                    </div>
                    <div class="form-group">
                        <label for="state_name">State Name *</label>
                        <input type="text" id="state_name" name="state_name" required 
                               placeholder="e.g., New York">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="property_tax_rate">Property Tax Rate (%) *</label>
                        <input type="number" id="property_tax_rate" name="property_tax_rate" required 
                               placeholder="4.57" min="0" max="20" step="0.01">
                        <small class="form-help">Annual property tax rate as percentage (e.g., 4.57% for Fairfax County)</small>
                    </div>
                    <div class="form-group">
                        <label for="pptra_relief">Relief Percentage (%)</label>
                        <input type="number" id="pptra_relief" name="pptra_relief" 
                               placeholder="51" min="0" max="100" step="1" value="0">
                        <small class="form-help">Tax relief percentage (e.g., 51% for Fairfax County PPTRA)</small>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="relief_cap">Relief Cap ($)</label>
                        <input type="number" id="relief_cap" name="relief_cap" 
                               placeholder="20000" min="0" step="1000" value="0">
                        <small class="form-help">Maximum vehicle value eligible for relief (e.g., $20,000 for Fairfax County)</small>
                    </div>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-success" id="submit-btn">Add State</button>
                    <button type="reset" class="btn btn-secondary" onclick="resetForm()">Reset</button>
                    <button type="button" class="btn btn-outline" id="cancel-edit" style="display: none;" onclick="cancelEdit()">Cancel Edit</button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
.states-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
    margin: 1.5rem 0;
}

.state-card {
    background: white;
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.state-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
}

.state-header h4 {
    margin: 0;
    color: #2c3e50;
    font-size: 1.2rem;
}

.default-badge {
    background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    color: white;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 600;
}

.state-details {
    margin-bottom: 1rem;
}

.tax-rate, .tax-relief {
    margin-bottom: 0.5rem;
    color: #34495e;
}

.state-actions {
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem; /* Added gap for buttons */
}

.btn-sm {
    padding: 0.5rem 1rem;
    font-size: 0.8rem;
}

.add-state-section {
    background: white;
    padding: 2rem;
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
    margin-top: 2rem;
}

.tax-header {
    text-align: center;
    margin-bottom: 2rem;
    padding: 2rem;
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.1);
}

.tax-header h1 {
    margin-bottom: 1rem;
    font-size: 2.5rem;
}

.tax-header p {
    color: #7f8c8d;
    font-size: 1.1rem;
    margin-bottom: 1.5rem;
}

.header-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    flex-wrap: wrap;
}
</style>

<script>
// No custom JS required now; inline edits handled via htmx in each row.
</script>
{% endblock %}
