{% extends "base.html" %}

{% block title %}CarKeep - Vehicle Cost Scenarios{% endblock %}

{% block content %}
<!-- Cache busting: {{ timestamp }} -->
<div class="scenarios-container fade-in">
    <div class="hero-section">
        <h1>üöó Vehicle Cost Scenarios</h1>
        <p class="hero-subtitle">Compare your current car costs with potential alternatives</p>
    </div>
    
    <div class="baseline-info">
        <div class="baseline-header">
            <h2>üìä Your Baseline: {{ baseline.vehicle.name }}</h2>
            <div class="baseline-stats">
                <span class="stat-item">
                    <strong>State:</strong> {{ baseline.state }}
                </span>
                <span class="stat-item">
                    <strong>Current Value:</strong> ${{ "{:,.0f}".format(baseline.vehicle.current_value) }}
                </span>
                <span class="stat-item">
                    <strong>Loan Balance:</strong> ${{ "{:,.0f}".format(baseline.current_loan.principal_balance) }}
                </span>
            </div>
            <div class="baseline-actions">
                <a href="{{ url_for('frontend.edit_baseline') }}" class="btn btn-secondary">
                    ‚úèÔ∏è Edit Baseline
                </a>
            </div>
        </div>
        <p class="baseline-description">{{ baseline.description }}</p>
    </div>
    
    <div class="scenarios-section">
        <div class="section-header">
            <h2>üîÑ Available Scenarios</h2>
            <p>Click on any scenario to view detailed cost comparisons</p>
        </div>
        
        <div class="scenarios-grid">
            {% for scenario_name, scenario_data in scenarios.items() %}
            <div class="scenario-card" data-scenario="{{ scenario_name }}">
                <div class="card-header">
                    <h3>{{ scenario_data.description }}</h3>
                    <div class="scenario-badge">
                        <span class="type {{ scenario_data.scenario.type }}">
                            {{ scenario_data.scenario.type|title }}
                        </span>
                    </div>
                </div>
                
                <div class="scenario-meta">
                    <div class="meta-item">
                        <span class="meta-label">Vehicle:</span>
                        <span class="vehicle">{{ scenario_data.scenario.vehicle.name }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">MSRP:</span>
                        <span class="price">${{ "{:,.0f}".format(scenario_data.scenario.vehicle.msrp) }}</span>
                    </div>
                    {% if scenario_data.scenario.financing.monthly_payment %}
                    <div class="meta-item">
                        <span class="meta-label">Monthly Payment:</span>
                        <span class="payment">${{ "{:,.0f}".format(scenario_data.scenario.financing.monthly_payment) }}</span>
                    </div>
                    {% endif %}
                </div>
                
                <div class="scenario-actions">
                    <a href="{{ url_for('frontend.view_scenario', scenario_name=scenario_name) }}" 
                       class="btn btn-primary" data-tooltip="View detailed cost analysis">
                        üìä View Results
                    </a>
                    <a href="{{ url_for('frontend.edit_scenario', scenario_name=scenario_name) }}" 
                       class="btn btn-secondary" data-tooltip="Edit this scenario">
                        ‚úèÔ∏è Edit
                    </a>
                    <button class="btn btn-info" onclick="duplicateScenario('{{ scenario_name }}')" 
                            data-tooltip="Create a copy of this scenario">
                        üìã Duplicate
                    </button>
                    <button class="btn btn-danger"
                            hx-post="{{ url_for('frontend.delete_scenario_action', scenario_name=scenario_name) }}"
                            hx-target="closest .scenario-card"
                            hx-swap="outerHTML:remove"
                            hx-confirm="Are you sure you want to delete &quot;{{ scenario_data.description }}&quot;? This cannot be undone."
                            data-tooltip="Delete this scenario">
                        üóëÔ∏è Delete
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    
    <div class="actions">
        <a href="{{ url_for('frontend.create_scenario') }}" class="btn btn-success">
            ‚ûï Create New Scenario
        </a>
        <a href="{{ url_for('frontend.comparison') }}" class="btn btn-info">
            <i class="fas fa-chart-bar"></i>
            Compare Scenarios
        </a>
    </div>
    
    <div class="quick-stats">
        <div class="stat-card">
            <div class="stat-number">{{ scenarios|length }}</div>
            <div class="stat-label">Total Scenarios</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ scenarios.values() | selectattr('scenario.type', 'equalto', 'lease') | list | length }}</div>
            <div class="stat-label">Lease Options</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">{{ scenarios.values() | selectattr('scenario.type', 'equalto', 'loan') | list | length }}</div>
            <div class="stat-label">Loan Options</div>
        </div>
    </div>
</div>

<!-- JavaScript functions are now in app.js -->
{% endblock %}
